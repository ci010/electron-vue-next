import{o as n,c as s,a}from"./app.dc01decd.js";const e='{"title":"electron-vue-next","description":"","frontmatter":{},"headers":[{"level":2,"title":"ç‰¹æ€§æ¸…å•","slug":"ç‰¹æ€§æ¸…å•"},{"level":2,"title":"ä¸Šæ‰‹æŒ‡å—","slug":"ä¸Šæ‰‹æŒ‡å—"},{"level":3,"title":"é…ç½®ä½ çš„é¡¹ç›®ä¿¡æ¯å’Œæ„å»ºè„šæœ¬","slug":"é…ç½®ä½ çš„é¡¹ç›®ä¿¡æ¯å’Œæ„å»ºè„šæœ¬"},{"level":2,"title":"é¡¹ç›®ç»“æ„","slug":"é¡¹ç›®ç»“æ„"},{"level":3,"title":"æ–‡ä»¶ç›®å½•ç»“æ„","slug":"æ–‡ä»¶ç›®å½•ç»“æ„"},{"level":3,"title":"ä¸»è¿›ç¨‹å’Œæ¸²æŸ“è¿›ç¨‹çš„æ¦‚å¿µ","slug":"ä¸»è¿›ç¨‹å’Œæ¸²æŸ“è¿›ç¨‹çš„æ¦‚å¿µ"},{"level":3,"title":"NPM è„šæœ¬","slug":"npm-è„šæœ¬"},{"level":2,"title":"å¼€å‘","slug":"å¼€å‘"},{"level":3,"title":"æœåŠ¡ (Service)","slug":"æœåŠ¡-service"},{"level":3,"title":"é™æ€èµ„æº","slug":"é™æ€èµ„æº"},{"level":3,"title":"Preload è„šæœ¬","slug":"preload-è„šæœ¬"},{"level":3,"title":"åœ¨æ¸²æŸ“è¿›ç¨‹ä¸­ä½¿ç”¨ Hooks (Composable)","slug":"åœ¨æ¸²æŸ“è¿›ç¨‹ä¸­ä½¿ç”¨-hooks-composable"},{"level":3,"title":"åœ¨æ¸²æŸ“è¿›ç¨‹ä¸­ä½¿ç”¨ Electron API","slug":"åœ¨æ¸²æŸ“è¿›ç¨‹ä¸­ä½¿ç”¨-electron-api"},{"level":3,"title":"ç®¡ç†ä¾èµ–","slug":"ç®¡ç†ä¾èµ–"},{"level":3,"title":"æ·»åŠ ä¸€ä¸ªæ–°çš„çª—å£","slug":"æ·»åŠ ä¸€ä¸ªæ–°çš„çª—å£"},{"level":3,"title":"å¤šçº¿ç¨‹ (Thread Worker)","slug":"å¤šçº¿ç¨‹-thread-worker"},{"level":3,"title":"åœ¨ VSCode ä¸­ Debug","slug":"åœ¨-vscode-ä¸­-debug"},{"level":3,"title":"å¯é€‰é¡¹: åœ¨æ¸²æŸ“è¿›ç¨‹ä¸­ä½¿ç”¨ Node æ¨¡å—","slug":"å¯é€‰é¡¹-åœ¨æ¸²æŸ“è¿›ç¨‹ä¸­ä½¿ç”¨-node-æ¨¡å—"},{"level":2,"title":"æ„å»º","slug":"æ„å»º"},{"level":3,"title":"ç¼–è¯‘æµç¨‹","slug":"ç¼–è¯‘æµç¨‹"},{"level":3,"title":"åœ¨æ„å»ºä¸­å‰”é™¤æŸäº›å…·ä½“æ–‡ä»¶","slug":"åœ¨æ„å»ºä¸­å‰”é™¤æŸäº›å…·ä½“æ–‡ä»¶"},{"level":2,"title":"å‘å¸ƒ","slug":"å‘å¸ƒ"},{"level":3,"title":"è‡ªåŠ¨æ›´æ–°çš„æ”¯æŒ","slug":"è‡ªåŠ¨æ›´æ–°çš„æ”¯æŒ"}],"relativePath":"zh/index.md","lastUpdated":1624345904684}',t={},o=a('<h1 id="electron-vue-next"><a class="header-anchor" href="#electron-vue-next" aria-hidden="true">#</a> electron-vue-next</h1><p>æ­¤ä»“åº“åŒ…å«äº†ä¸€ä¸ªç”¨äºå¿«é€Ÿä¸Šæ‰‹ vue-next å’Œ electron çš„æ¨¡æ¿~</p><p><em>æˆ‘é€šè¿‡ä½¿ç”¨ <a href="https://github.com/SimulatedGREG/electron-vue" target="_blank" rel="noopener noreferrer">electron-vue</a>ï¼Œå­¦ä¹ äº†å¦‚ä½•ä½¿ç”¨ electron å’Œ vueã€‚æ‰€ä»¥è¿™ä¸ªé¡¹ç›®å¾ˆå¤§ç¨‹åº¦ä¸Šå—åˆ°äº†å®ƒçš„å¯å‘ã€‚</em></p><p><em>å¸Œæœ›ä½ åœ¨ä½¿ç”¨è¿™ä¸ªæ¨¡æ¿çš„æ—¶å€™èƒ½å¤Ÿé€æ¸ç†Ÿæ‚‰ rollup å’Œå®ƒçš„ API</em> ğŸ˜ƒ</p><h2 id="ç‰¹æ€§æ¸…å•"><a class="header-anchor" href="#ç‰¹æ€§æ¸…å•" aria-hidden="true">#</a> ç‰¹æ€§æ¸…å•</h2><ul><li>Electron 11 <ul><li>éµä» <a href="https://www.electronjs.org/docs/tutorial/security" target="_blank" rel="noopener noreferrer"> å®‰å…¨æ€§ï¼ŒåŸç”Ÿèƒ½åŠ›å’Œä½ çš„è´£ä»» </a> è¿™ç¯‡æ–‡ç« çš„æŒ‡å¯¼ï¼Œå°† renderer è¿›ç¨‹é…ç½®ä¸ºçº¯â€œæµè§ˆå™¨ç¯å¢ƒâ€ï¼ˆæ²¡æœ‰ node ç¯å¢ƒï¼‰</li><li>ä½¿ç”¨ <a href="https://github.com/electron-userland/electron-builder" target="_blank" rel="noopener noreferrer">electron-builder</a> æ¥æ„å»ºé¡¹ç›®</li></ul></li><li>è·Ÿéš <a href="https://github.com/vuejs/vue-next" target="_blank" rel="noopener noreferrer">vue-next</a> çš„æ–°ç”Ÿæ€ <ul><li>ä½¿ç”¨ <a href="https://github.com/vitejs/vite" target="_blank" rel="noopener noreferrer">vite</a> æ¥æ„å»º renderer è¿›ç¨‹ï¼Œçƒ­é‡è½½é€Ÿåº¦éå¸¸ä¹‹å¿«</li><li>ä½¿ç”¨ <a href="https://github.com/vuejs/vuex/tree/4.0" target="_blank" rel="noopener noreferrer">vuex 4.0</a>ï¼Œå¹¶è‡ªå¸¦ç±»å‹æ¨æ–­ä»£ç ï¼Œå°½å¯èƒ½åˆ©ç”¨ typescript çš„ç±»å‹ç³»ç»Ÿ</li><li>ä½¿ç”¨äº†æ–°çš„ <a href="https://github.com/vuejs/vue-router-next" target="_blank" rel="noopener noreferrer">vue-router-next</a></li></ul></li><li>å†…ç½® <a href="https://www.npmjs.com/package/eslint" target="_blank" rel="noopener noreferrer">eslint</a>ï¼Œé»˜è®¤ä½¿ç”¨ Javascript Standard</li><li>å†…ç½® TypeScript <ul><li>ä½¿ç”¨ <a href="https://github.com/evanw/esbuild" target="_blank" rel="noopener noreferrer">esbuild</a> å’Œ <a href="https://github.com/rollup/rollup" target="_blank" rel="noopener noreferrer">rollup</a> æ¥æ„å»º main è¿›ç¨‹çš„ typescriptï¼ˆå’Œ vite ä½¿ç”¨çš„ esbuild ç‰ˆæœ¬ç›¸åŒï¼‰</li></ul></li><li>å¼€ç®±å³ç”¨çš„ NodeJS å¤šçº¿ç¨‹æ”¯æŒ <ul><li>æ¨¡æ¿ä¸­å·²ç»æŠŠ worker script çš„æ‰“åŒ…è¿‡ç¨‹é…ç½®å¥½äº†ï¼Œä½¿ç”¨æ—¶æ— éœ€å†è°ƒæ•´æ„å»ºé…ç½®</li></ul></li><li>å¼€ç®±å³ç”¨çš„ preload çš„æ”¯æŒ <ul><li>æ¨¡æ¿ä¸­å·²ç»æŠŠ preload çš„æ‰“åŒ…è¿‡ç¨‹é…ç½®å¥½äº†ï¼Œä½¿ç”¨æ—¶æ— éœ€å†è°ƒæ•´æ„å»ºé…ç½®</li><li>åœ¨å¼€å‘æ¨¡å¼ä¸‹æ”¯æŒ preload è‡ªåŠ¨é‡è½½ã€‚preload script çš„å˜åŒ–ä¸ä¼šå¯¼è‡´æ•´ä¸ª Electron App é‡å¯ã€‚</li></ul></li><li>å¼€ç®±å³ç”¨çš„ Github Action å‘å¸ƒæµç¨‹ <ul><li>è‡ªåŠ¨å‡çº§ç‰ˆæœ¬å·å¹¶ä¸”ç”Ÿæˆæ›´å˜æ—¥å¿—ï¼Œåªè¦ä½ çš„ git commits éµä» <a href="https://www.conventionalcommits.org/en/v1.0.0" target="_blank" rel="noopener noreferrer">Conventional Commits</a></li><li>å…·ä½“ç»†èŠ‚ä½ å¯ä»¥åœ¨ <a href="#%E5%8F%91%E5%B8%83">å‘å¸ƒ</a> è¿™ä¸ªç« èŠ‚æŸ¥æ‰¾</li></ul></li><li>å’Œ VSCode é›†æˆ <ul><li>è‡ªå¸¦ VSCode çš„ Debug é…ç½®ã€‚å¯ä»¥åœ¨ VSCode ä¸­ debug typescript å’Œ vue æ–‡ä»¶ï¼Œmain å’Œ renderer çš„éƒ½å¯ä»¥ã€‚</li><li>å…·ä½“å®ç°ç»†èŠ‚å¯ä»¥çœ‹ <a href="#%E5%9C%A8-vscode-%E4%B8%AD-debug">Debug</a> è¿™ä¸ªç« èŠ‚</li></ul></li><li>æ”¯æŒå¤šçª—å£ <ul><li>å¯ä»¥ç®€å•åœ°è®© App å¢åŠ ä¸€ä¸ªæ–°çš„çª—å£ï¼Œè¯¦æƒ…å‚è§ <a href="#%E6%B7%BB%E5%8A%A0%E4%B8%80%E4%B8%AA%E6%96%B0%E7%9A%84%E7%AA%97%E5%8F%A3">å¦‚ä½•æ·»åŠ ä¸€ä¸ªæ–°çš„çª—å£</a></li></ul></li><li>Vue Devtools å¼€ç®±å³ç”¨ <ul><li>é€šè¿‡ npm run postinstall æ¥ç¡®ä¿ devtools çš„å®‰è£…</li><li>æ”¯æŒæ–°çš„ vue-router-next å’Œ vuex 4</li></ul></li></ul><h2 id="ä¸Šæ‰‹æŒ‡å—"><a class="header-anchor" href="#ä¸Šæ‰‹æŒ‡å—" aria-hidden="true">#</a> ä¸Šæ‰‹æŒ‡å—</h2><p>é€šè¿‡ npm init æ¥åˆ›å»ºæ¨¡æ¿:</p><p><code>npm init electron-vue-next</code></p><p>ä¹‹ååœ¨ä»“åº“æ ¹ç›®å½•ä¸‹:</p><div class="language-shell"><pre><code><span class="token comment"># å®‰è£…ä¾èµ–</span>\n<span class="token function">npm</span> <span class="token function">install</span>\n\n<span class="token comment"># åˆ›å»º dev æœåŠ¡å™¨ï¼Œå°†å¯åŠ¨ electron å’Œ vite çš„çƒ­é‡è½½æœåŠ¡å™¨</span>\n<span class="token function">npm</span> run dev\n\n<span class="token comment"># å¯é€‰. å°† main å’Œ renderer è¿›ç¨‹ç¼–è¯‘æˆ JavaScriptï¼Œå¹¶æ˜¾ç¤ºè¾“å‡ºå¤§å°</span>\n<span class="token function">npm</span> run build\n\n<span class="token comment"># å¯é€‰. å°†æ‰€æœ‰ç¼–è¯‘è¾“å‡ºæ‰“åŒ…åˆ°ä¸€ä¸ª electron åº”ç”¨ç¨‹åºä¸­ï¼Œä»¥æ–‡ä»¶å¤¹å½¢å¼å­˜åœ¨</span>\n<span class="token function">npm</span> run build:dir\n\n<span class="token comment"># å°†æ‰€æœ‰è¾“å‡ºæ‰“åŒ…åˆ°å®é™…çš„ electron å®‰è£…åŒ…ä¸­</span>\n<span class="token function">npm</span> run build:production\n\n</code></pre></div><h3 id="é…ç½®ä½ çš„é¡¹ç›®ä¿¡æ¯å’Œæ„å»ºè„šæœ¬"><a class="header-anchor" href="#é…ç½®ä½ çš„é¡¹ç›®ä¿¡æ¯å’Œæ„å»ºè„šæœ¬" aria-hidden="true">#</a> é…ç½®ä½ çš„é¡¹ç›®ä¿¡æ¯å’Œæ„å»ºè„šæœ¬</h3><p>åœ¨ä½ å®‰è£…å®Œé¡¹ç›®ä¾èµ–ä¹‹åï¼Œä½ åº”è¯¥é¦–å…ˆå» <a href="https://github.com/ci010/electron-vue-next/tree/master/electron-vue-next/package.json" target="_blank" rel="noopener noreferrer">package.json</a> ä¸­æ›´æ”¹é¡¹ç›®åŸºæœ¬ä¿¡æ¯ï¼Œå¦‚é¡¹ç›®åï¼Œä½œè€…ä¿¡æ¯ï¼Œgit ä»“åº“åœ°å€ç­‰ã€‚ åŒæ—¶ä½ éœ€è¦æ›´æ–°æ„å»ºä¿¡æ¯ <a href="https://github.com/ci010/electron-vue-next/tree/master/electron-vue-next/scripts/build.base.config.js" target="_blank" rel="noopener noreferrer">build.base.config.js</a>ï¼Œ</p><h2 id="é¡¹ç›®ç»“æ„"><a class="header-anchor" href="#é¡¹ç›®ç»“æ„" aria-hidden="true">#</a> é¡¹ç›®ç»“æ„</h2><h3 id="æ–‡ä»¶ç›®å½•ç»“æ„"><a class="header-anchor" href="#æ–‡ä»¶ç›®å½•ç»“æ„" aria-hidden="true">#</a> æ–‡ä»¶ç›®å½•ç»“æ„</h3><p>æ•´ä¸ªé¡¹ç›®çš„æ–‡ä»¶ç»“æ„å¤§æ¦‚å¦‚æ­¤ï¼š</p><div class="language-"><pre><code>your-project\nâ”œâ”€ scripts                 æ‰€æœ‰çš„è„šæœ¬æ–‡ä»¶å¤¹ï¼Œæ¯”å¦‚ build çš„è„šæœ¬å°±åœ¨è¿™æ”¾ç€\nâ”œâ”€ extensions              vue-devtools æ‹“å±•ä¸´æ—¶å­˜æ”¾çš„æ–‡ä»¶å¤¹\nâ”œâ”€ build                   build ä½¿ç”¨çš„èµ„æºæ–‡ä»¶ï¼ŒåŒæ—¶ä¹Ÿæ˜¯ build çš„è¾“å‡ºæ–‡ä»¶å¤¹\nâ”‚  â””â”€ icons/               build ä½¿ç”¨çš„å›¾æ ‡æ–‡ä»¶\nâ”œâ”€ dist                    ç¼–è¯‘åçš„jsä¼šåœ¨è¿™\nâ”œâ”€ src\nâ”‚  â”œâ”€ main\nâ”‚  â”‚  â”œâ”€ services/         åŒ…å«ä¸€äº› App ä¸ç½‘ç»œã€ç£ç›˜æ–‡ä»¶äº¤äº’çš„çš„ä¸šåŠ¡é€»è¾‘\nâ”‚  â”‚  â”œâ”€ workers/          ä½¿ç”¨ nodejs worker_threads çš„å¤šçº¿ç¨‹è„šæœ¬\nâ”‚  â”‚  â”œâ”€ dialog.ts         å¯¹ electron dialog API çš„ç®€å•å°è£…ï¼Œè®© renderer å¯ä»¥ä½¿ç”¨ dialog\nâ”‚  â”‚  â”œâ”€ global.ts         typescript çš„ä¸€äº›å…¨å±€å®šä¹‰\nâ”‚  â”‚  â”œâ”€ index.dev.ts      rollup å¼€å‘ç¯å¢ƒçš„å…¥å£æ–‡ä»¶\nâ”‚  â”‚  â”œâ”€ index.ts          å…±äº«çš„å…¥å£æ–‡ä»¶ï¼ŒåŸºæœ¬é€»è¾‘éƒ½ä»è¿™å¼€å§‹\nâ”‚  â”‚  â””â”€ logger.ts         ä¸€ä¸ªç®€å•çš„ Logger\nâ”‚  â”œâ”€ preload\nâ”‚  â”‚  â”œâ”€ index.ts          preload å…¥å£\nâ”‚  â”‚  â””â”€ another.ts        å¦ä¸€ä¸ª preload å…¥å£\nâ”‚  â”œâ”€ renderer\nâ”‚  â”‚  â”œâ”€ assets/           assets æ–‡ä»¶å¤¹\nâ”‚  â”‚  â”œâ”€ components/       æ‰€æœ‰ vue components\nâ”‚  â”‚  â”œâ”€ hooks/            é’©å­å‡½æ•°æˆ–ç»„åˆå¼ API\nâ”‚  â”‚  â”œâ”€ router.ts         vue-router åˆå§‹ä»£ç \nâ”‚  â”‚  â”œâ”€ store.ts          vuex åˆå§‹ä»£ç \nâ”‚  â”‚  â”œâ”€ App.vue           Vue æ–‡ä»¶çš„å…¥å£æ–‡ä»¶ï¼Œè¢« index.ts å¯¼å…¥\nâ”‚  â”‚  â”œâ”€ index.css         vite ä¼šç¼–è¯‘çš„ css çš„å…¥å£æ–‡ä»¶\nâ”‚  â”‚  â”œâ”€ index.html        vite ä¼šç¼–è¯‘çš„ html çš„å…¥å£æ–‡ä»¶\nâ”‚  â”‚  â””â”€ index.ts          vite ä¼šç¼–è¯‘çš„ typescript çš„å…¥å£æ–‡ä»¶\nâ”‚  â””â”€ shared               åœ¨ main å’Œ renderer ä¹‹é—´å…±äº«çš„ä»£ç æ–‡ä»¶å¤¹ï¼Œå…¶ä¸­ä»£ç ä¸¤è¾¹éƒ½å¯ä»¥ import åˆ°\nâ”‚     â”œâ”€ store/            vuex store çš„å®šä¹‰\nâ”‚     â””â”€ sharedLib.ts      ä¸€ä¸ªç®€å•çš„ main/renderer å…±äº«æ¨¡å—çš„ä¾‹å­\nâ”œâ”€ static/                 é™æ€èµ„æºæ–‡ä»¶å¤¹\nâ”œâ”€ .eslintrc.js\nâ”œâ”€ .gitignore\nâ”œâ”€ package.json\nâ””â”€ README.md\n</code></pre></div><h4 id="assets-é™æ€èµ„æº-static-æ„å»ºèµ„æº-æœ‰å•¥åŒºåˆ«ï¼Ÿ"><a class="header-anchor" href="#assets-é™æ€èµ„æº-static-æ„å»ºèµ„æº-æœ‰å•¥åŒºåˆ«ï¼Ÿ" aria-hidden="true">#</a> assets, é™æ€èµ„æº (static), æ„å»ºèµ„æº... æœ‰å•¥åŒºåˆ«ï¼Ÿ</h4><p>assets æ–‡ä»¶åªåœ¨ Renderer è¿›ç¨‹ä¸­ä½¿ç”¨ï¼Œä»–ä»¬ä¼šè¢« viteï¼Œä¹Ÿå°±æ˜¯ rollup ç³»ç»Ÿæ‰“åŒ…åˆ°æœ€ç»ˆçš„æ„å»ºæ–‡ä»¶ä¸­ï¼Œä½ å¯ä»¥ç›´æ¥åœ¨ vue/ts æ–‡ä»¶ä¸­ import ä»–ä»¬ï¼ŒåŸºæœ¬ä¸Šä¸ç”¨è‡ªå·±å…³å¿ƒã€‚assets é»˜è®¤ä½ç½®åœ¨ <a href="https://github.com/ci010/electron-vue-next/tree/master/electron-vue-next/src/renderer/assets" target="_blank" rel="noopener noreferrer">renderer/renderer/assets</a></p><p>é™æ€èµ„æºï¼ŒæŒ‡çš„æ˜¯ä¸€äº›éœ€è¦è¢« main è¿›ç¨‹åœ¨è¿è¡Œä¸­ä½¿ç”¨çš„æ–‡ä»¶ï¼Œæ¯”å¦‚ä½ çš„ç³»ç»Ÿæ‰˜ç›˜å°å›¾æ ‡ (Tray) å°±éœ€è¦æ”¾åœ¨ static æ–‡ä»¶å¤¹ä¸­ï¼Œåœ¨è¿è¡Œæ—¶é€šè¿‡æ–‡ä»¶ç³»ç»Ÿ (fs) è·å–ã€‚æˆ–å¦‚ä½ éœ€è¦åœ¨ Windows ä¸‹è¿è¡Œä¸€æ®µ powershellï¼Œè¿™äº› powershell æ–‡ä»¶é€šå¸¸å°±éœ€è¦æ”¾åœ¨ static æ–‡ä»¶å¤¹ä¸‹ï¼Œå¹¶ä¸”åœ¨æ„å»ºé…ç½®æ–‡ä»¶ä¸­æ˜ç¡®æ ‡å‡º asarUnpackã€‚é»˜è®¤é™æ€æ–‡ä»¶å¤¹åœ¨ <a href="https://github.com/ci010/electron-vue-next/tree/master/electron-vue-next/static" target="_blank" rel="noopener noreferrer">static</a>ã€‚</p><p>è€Œæ„å»ºèµ„æºæ˜¯æŒ‡é‚£äº›è¢« <code>electron-builder</code> ä½¿ç”¨çš„èµ„æºï¼Œä»–ä»¬ä¼šç”¨æ¥æ„å»ºå®‰è£…åŒ…ç­‰ã€‚ä¾‹å¦‚ç¨‹åºçš„å›¾æ ‡ï¼Œå®‰è£…ç¨‹åºçš„è‡ªå®šä¹‰è„šæœ¬ç­‰ã€‚é»˜è®¤çš„ç¨‹åºå›¾æ ‡æ”¾åœ¨ <a href="https://github.com/ci010/electron-vue-next/tree/master/electron-vue-next/build/icons" target="_blank" rel="noopener noreferrer">build/icons</a> é‡Œã€‚</p><p><em>è¯·æ³¨æ„ä½ çš„ç¨‹åºå›¾æ ‡å¯èƒ½éœ€è¦åœ¨å„ç§åœ°æ–¹ä½¿ç”¨ï¼ä¸è¦æ··æ·†ä»–ä»¬ï¼</em></p><ul><li><em>å¯¹äºå®‰è£…åŒ…å›¾æ ‡, ä»–ä»¬åº”è¯¥åœ¨ <code>build/icons</code>ï¼Œè¿™ä¼šå½±å“ä¾‹å¦‚å®‰è£…åŒ…å›¾æ ‡ï¼Œæˆ–è€…åœ¨ File Explorer ä¸­æ˜¾ç¤ºçš„å›¾æ ‡</em></li><li><em>å¯¹äºé™æ€èµ„æºä¸­çš„å›¾æ ‡ï¼Œä¸€èˆ¬æ˜¯ç”¨ä½œäºè®¾ç½® <strong>(ç³»ç»Ÿæ‰˜ç›˜) tray</strong> æˆ–è€…å½“å‰çª—å£åœ¨ä»»åŠ¡æ çš„å›¾æ ‡</em></li><li><em>å¯¹äºåœ¨ assets ä¸­çš„å›¾æ ‡ï¼Œè¿™äº›ä¸€èˆ¬ä½¿ç”¨åœ¨é¡µé¢å†…æ˜¾ç¤º logo</em></li></ul><h3 id="ä¸»è¿›ç¨‹å’Œæ¸²æŸ“è¿›ç¨‹çš„æ¦‚å¿µ"><a class="header-anchor" href="#ä¸»è¿›ç¨‹å’Œæ¸²æŸ“è¿›ç¨‹çš„æ¦‚å¿µ" aria-hidden="true">#</a> ä¸»è¿›ç¨‹å’Œæ¸²æŸ“è¿›ç¨‹çš„æ¦‚å¿µ</h3><p>ä» Electron å®˜æ–¹æ–‡æ¡£ <a href="https://www.electronjs.org/docs/tutorial/quick-start#main-and-renderer-processes" target="_blank" rel="noopener noreferrer">main and renderer processes</a> å¼•ç”¨çš„è§£é‡Šã€‚ä¸»è¿›ç¨‹ (main process) æ˜¯</p><blockquote><ul><li>ä¸»è¿›ç¨‹é€šè¿‡åˆ›å»º BrowserWindow å®ä¾‹æ¥åˆ›å»º ç½‘é¡µã€‚ æ¯ä¸€ä¸ª BrowserWindow å®ä¾‹åœ¨å…¶æ¸²æŸ“è¿‡ç¨‹ä¸­è¿è¡Œç½‘é¡µï¼Œ å½“ä¸€ä¸ª BrowserWindow å®ä¾‹è¢«é”€æ¯æ—¶ï¼Œå¯¹åº”çš„æ¸²æŸ“è¿‡ç¨‹ä¹Ÿä¼šè¢«ç»ˆæ­¢ã€‚</li><li>ä¸»è¿›ç¨‹ ç®¡ç† æ‰€æœ‰ç½‘é¡µåŠå…¶å¯¹åº”çš„æ¸²æŸ“è¿›ç¨‹ã€‚</li></ul></blockquote><p>è€Œæ¸²æŸ“è¿›ç¨‹ (renderer process) åˆ™æ˜¯</p><blockquote><ul><li>æ¸²æŸ“è¿›ç¨‹åªèƒ½ç®¡ç†ç›¸åº”çš„ç½‘é¡µï¼Œ ä¸€ä¸ªæ¸²æŸ“è¿›ç¨‹çš„å´©æºƒä¸ä¼šå½±å“å…¶ä»–æ¸²æŸ“è¿›ç¨‹ã€‚</li><li>æ¸²æŸ“è¿›ç¨‹é€šè¿‡ IPC ä¸ä¸»è¿›ç¨‹é€šä¿¡åœ¨ç½‘åœ¨é¡µä¸Šæ‰§è¡Œ GUI æ“ä½œã€‚ å‡ºäºå®‰å…¨å’Œå¯èƒ½çš„èµ„æºæ³„æ¼è€ƒè™‘ï¼Œç›´æ¥ä»æ¸²æŸ“å™¨è¿›ç¨‹ä¸­è°ƒç”¨ä¸æœ¬åœ° GUI æœ‰å…³çš„ API å—åˆ°é™åˆ¶ã€‚</li></ul></blockquote><p>ä¸€èˆ¬æ¥è®²ï¼Œä¸»è¿›ç¨‹åŒ…å«äº†ä½ çš„æ ¸å¿ƒä¸šåŠ¡é€»è¾‘ï¼Œè€Œæ¸²æŸ“è¿›ç¨‹åˆ™è´Ÿè´£æ˜¾ç¤ºã€‚å½“ç„¶è¿™ä¸ç»å¯¹ï¼Œæœ‰äº›äººè®¤ä¸ºä¸»è¿›ç¨‹å°±åº”è¯¥åªè´Ÿè´£ä¸€äº›å’Œç³»ç»Ÿäº¤äº’çš„æ“ä½œï¼Œä¸åº”è¯¥æœ‰é‡ CPU çš„æ“ä½œï¼Œå› ä¸ºå¦‚æœä¸»è¿›ç¨‹ CPU è´Ÿè·è¿‡é«˜ä¼šå°†æ•´ä¸ª App å¡ä½ï¼ˆå¹¸å¥½ Nodejs å¤§éƒ¨åˆ† IO API éƒ½æ˜¯ asyncï¼Œå¹¶ä¸ä¼šå¡ä½æ•´ä¸ª appï¼‰ã€‚å› æ­¤å¦‚æœä½ æœ‰ä¸€äº›éå¸¸åƒ CPU çš„å·¥ä½œï¼Œåº”è¯¥è€ƒè™‘ç”¨ nodejs çš„ <a href="https://nodejs.org/api/worker_threads.html" target="_blank" rel="noopener noreferrer">worker_thread</a> æŠŠä»–ä»¬æ”¾åˆ°åˆ«çš„çº¿ç¨‹ä¸­ã€‚</p><p>æ‰€ä»¥è¿™æ–¹é¢çš„è®¾è®¡å’Œä½ çš„ app çš„ä¸šåŠ¡é«˜åº¦ç›¸å…³ï¼Œå¦‚æœä½ çš„ä¸šåŠ¡åªæ˜¯æœ‰é¢‘ç¹çš„ IO æ“ä½œï¼ŒæŠŠè¿™äº›é€»è¾‘æ”¾åœ¨ main ä¹Ÿæ²¡ä»€ä¹ˆé—®é¢˜ã€‚å¦‚æœä½ çš„ä¸šåŠ¡éœ€è¦å ç”¨ CPU å¾ˆé•¿æ—¶é—´ï¼Œä½ åˆ™éœ€è¦è€ƒè™‘æŠŠä»–ä»¬æ”¾åœ¨ main è¿›ç¨‹ä¹‹å¤–çš„åœ°æ–¹äº†ã€‚</p><p>æ ¹æ® electron çš„ <a href="https://www.electronjs.org/docs/tutorial/security" target="_blank" rel="noopener noreferrer">security</a> æ•™ç¨‹ã€‚åœ¨è¿™ä¸ªæ¨¡æ¿ä¸­ï¼Œrenderer è¿›ç¨‹ <a href="https://www.electronjs.org/docs/tutorial/security#2-do-not-enable-nodejs-integration-for-remote-content" target="_blank" rel="noopener noreferrer">é»˜è®¤æƒ…å†µä¸‹ <strong>å¹¶æ²¡æœ‰</strong> æƒé™å»è®¿é—® nodejs çš„æ¨¡å—</a>. Electron åœ¨ <code>webPreferences</code> é‡Œæä¾›äº† <code>preload</code> é€‰é¡¹æ¥å¤„ç†è¿™ç§é—®é¢˜ã€‚åœ¨è¿™ä¸ªæ¨¡æ¿ä¸­ï¼Œæˆ‘ä»¬åˆ™æä¾›äº† <code>Service</code> æ¥å¤„ç†è¿™ä¸ªé—®é¢˜ã€‚</p><p><code>Service</code> æ˜¯ä¸€ç³»åˆ—å®šä¹‰åœ¨ <code>src/main/services</code> æ–‡ä»¶å¤¹ä¸‹çš„ classã€‚<code>Service</code> æ‰€æœ‰çš„ public æ–¹æ³•ï¼Œç»è¿‡æˆ‘ä»¬çš„å°è£…ï¼Œéƒ½å¯ä»¥ç®€å•åœ°åœ¨ renderer è¿›ç¨‹è®¿é—®ã€‚ å®ƒä¹Ÿå¯ä»¥çœ‹ä½œä¸€ä¸ª main å’Œ renderer è¿›ç¨‹ä¹‹é—´çš„æ¡¥æ¢ã€‚ä½ å¯ä»¥å‚è€ƒ <a href="#%E6%9C%8D%E5%8A%A1-service">Service</a> ç« èŠ‚æ¥ä¸€æ¢ç©¶ç«Ÿã€‚</p><p><em><strong>è¯·æ³¨æ„ Serivce æ˜¯ä¸€ä¸ªéå¸¸æœ´ç´ ç®€å•çš„è§£å†³æ–¹æ¡ˆã€‚å®ƒæ˜¯ä»ä¸€ä¸ªæ›´ä¸ºå¤æ‚çš„ä¸ªäººé¡¹ç›®ä¸­æŠ½å–æˆçš„ä¸€ä¸ªç›¸å¯¹ç®€å•çš„å®ç°æ–¹æ¡ˆã€‚å®ƒåªæ˜¯å±•ç¤ºä¸€ç§å¯èƒ½æ€§ï¼Œå®é™…ä¸Šä½ å¯èƒ½éœ€è¦æ ¹æ®ä½ çš„å®é™…æƒ…å†µè°ƒæ•´ Service çš„è®¾è®¡ï¼</strong></em></p><h3 id="npm-è„šæœ¬"><a class="header-anchor" href="#npm-è„šæœ¬" aria-hidden="true">#</a> NPM è„šæœ¬</h3><h4 id="npm-run-dev"><a class="header-anchor" href="#npm-run-dev" aria-hidden="true">#</a> <code>npm run dev</code></h4><p>å¼€å¯ vite å¼€å‘ç¯å¢ƒï¼Œvite å°†æä¾› renderer ï¼ˆæµè§ˆå™¨ç«¯ï¼‰çš„çƒ­é‡è½½ã€‚ åŒæ—¶å¼€å¯ä¸€ä¸ª rollup å¼€å‘ç¯å¢ƒï¼Œæ£€æµ‹ main ç«¯çš„ä»£ç å˜åŒ–ï¼Œå¦‚æœ main çš„ä»£ç æœ‰å˜åŠ¨ï¼Œå®ƒä¼šè‡ªåŠ¨é‡å¯ä½ çš„æ•´ä¸ª electron ç¨‹åºã€‚</p><h4 id="npm-run-build"><a class="header-anchor" href="#npm-run-build" aria-hidden="true">#</a> <code>npm run build</code></h4><p>å°† <code>main</code> å’Œ <code>renderer</code> çš„ä»£ç ç¼–è¯‘åˆ° production ç¯å¢ƒ, è¾“å‡ºçš„ä»£ç åœ¨ <code>dist</code></p><h4 id="npm-run-build-production"><a class="header-anchor" href="#npm-run-build-production" aria-hidden="true">#</a> <code>npm run build:production</code></h4><p>ç¼–è¯‘æ‰€æœ‰ä»£ç ï¼Œå¹¶ä¸”ä½¿ç”¨ <code>electron-builder</code> æ¥ä½ çš„ app build æˆå¯æ‰§è¡Œçš„ exe æ–‡ä»¶æˆ–è€… zip ç­‰ã€‚è¿™ä¸ªçš„é…ç½®æ–‡ä»¶åœ¨ <a href="https://github.com/ci010/electron-vue-next/tree/master/electron-vue-next/scripts/build.base.config.js" target="_blank" rel="noopener noreferrer">scripts/build.base.config.js</a>ã€‚</p><h4 id="npm-run-build-dir"><a class="header-anchor" href="#npm-run-build-dir" aria-hidden="true">#</a> <code>npm run build:dir</code></h4><p>ç¼–è¯‘æ‰€æœ‰ä»£ç , å¹¶ä¸”ä½¿ç”¨ <code>electron-builder</code> ç¼–è¯‘ä½ çš„ app åˆ° production ç¯å¢ƒï¼Œä½†å®ƒåªè¾“å‡ºæ–‡ä»¶å¤¹å½¢å¼çš„ build ï¼ˆä¸æ‰“åŒ…æˆå®‰è£…ç¨‹åºï¼‰ï¼Œæ¯”å¦‚å¯¹äº windows x64ï¼Œä»–ä¼šæŠŠä½ çš„ç¨‹åºç¼–è¯‘åˆ° <code>build/win-unpacked</code>ï¼Œå¹¶ä¸è¾“å‡º installerã€‚</p><p>è‡ªç„¶ï¼Œè¿™ä¸ªä¼šæ¯” <code>npm run build:production</code> å¿«ã€‚ä½ å¯ä»¥ä½¿ç”¨å®ƒæ¥å¿«é€Ÿæµ‹è¯• production çš„è½¯ä»¶è¿è¡ŒçŠ¶å†µã€‚</p><h4 id="npm-run-lint"><a class="header-anchor" href="#npm-run-lint" aria-hidden="true">#</a> <code>npm run lint</code></h4><p>ä½¿ç”¨ eslint æ¥æ£€æŸ¥ä»£ç é£æ ¼ã€‚</p><h4 id="npm-run-lint-fix"><a class="header-anchor" href="#npm-run-lint-fix" aria-hidden="true">#</a> <code>npm run lint:fix</code></h4><p>ä½¿ç”¨ eslint æ¥æ£€æŸ¥ä»£ç é£æ ¼å¹¶å°½å¯èƒ½çš„ä¿®å¤ã€‚</p><h2 id="å¼€å‘"><a class="header-anchor" href="#å¼€å‘" aria-hidden="true">#</a> å¼€å‘</h2><p>æœ¬é¡¹ç›®é»˜è®¤éµä» <a href="https://www.electronjs.org/docs/tutorial/security" target="_blank" rel="noopener noreferrer">security</a>ã€‚åœ¨é»˜è®¤æƒ…å†µä¸‹ï¼ŒRenderer (æµè§ˆå™¨) ä¸èƒ½è®¿é—® NodeJS çš„æ¨¡å—ï¼Œè¿™æ„å‘³ç€ä½ ä¸èƒ½åœ¨æµè§ˆå™¨ä¸­ç›´æ¥è®¿é—® fs æ¥è¯»å†™æ–‡ä»¶ã€‚ä½ éœ€è¦é€šè¿‡ä½¿ç”¨ <a href="https://github.com/ci010/electron-vue-next/tree/master/electron-vue-next/src/main/services/Service.ts" target="_blank" rel="noopener noreferrer">Service</a> æ¥è®¿é—® NodeJS èµ„æºã€‚åœ¨ vue ä¸­ä½¿ç”¨ <code>useService(&#39;NameOfService&#39;)</code> æ¥è·å¾— service æä¾›çš„æ–¹æ³•ã€‚</p><h3 id="æœåŠ¡-service"><a class="header-anchor" href="#æœåŠ¡-service" aria-hidden="true">#</a> æœåŠ¡ (Service)</h3><p>æ‰€æœ‰ Service çš„å®ç°éƒ½æ”¾åœ¨ <code>src/main/services</code>ã€‚Service åº”è¯¥åŒ…å«ä¸€äº› App ä¸ç½‘ç»œã€ç£ç›˜æ–‡ä»¶äº¤äº’çš„çš„æ ¸å¿ƒä¸šåŠ¡é€»è¾‘ï¼Œè¿™äº›é€»è¾‘å°†è¿è¡Œåœ¨ä¸»è¿›ç¨‹ã€‚Service ä¼šè‡ªåŠ¨æš´éœ²æ¥å£åˆ°æ¸²æŸ“è¿›ç¨‹ï¼Œåœ¨æ¸²æŸ“è¿›ç¨‹ä¸­ï¼Œä½ å¯ä»¥é€šè¿‡ä¸€ä¸ª <code>useService(&#39;NameOfService&#39;)</code> æ¥ç›´æ¥ä½¿ç”¨ Serviceã€‚</p><p>Serivce æœ¬èº«æ˜¯å®Œå…¨å¯é€‰çš„ã€‚ä¹‹æ‰€ä»¥æœ‰è¿™ç§è®¾è®¡æ˜¯å› ä¸º Electron æå€¡çš„å®‰å…¨æ€§ <em><strong>å¦‚æœä½ è®¤ä¸ºè¿™ä¸ªè®¾è®¡æ˜¯å¤šä½™çš„ï¼Œæˆ–è€…æ˜¯è¿‡åº¦è®¾è®¡ï¼Œä½ å®Œå…¨å¯ä»¥ç§»é™¤å®ƒã€‚</strong></em></p><h4 id="åˆ›å»ºä¸€ä¸ªæ–°-service"><a class="header-anchor" href="#åˆ›å»ºä¸€ä¸ªæ–°-service" aria-hidden="true">#</a> åˆ›å»ºä¸€ä¸ªæ–° Service</h4><p>åœ¨ <code>/src/main/services</code> é‡Œæ·»åŠ ä¸€ä¸ªæ–‡ä»¶å« <code>BarService.ts</code></p><div class="language-ts"><pre><code><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">BarService</span> <span class="token keyword">extends</span> <span class="token class-name">Service</span> <span class="token punctuation">{</span>\n  <span class="token keyword">async</span> <span class="token function">doSomeCoreLogic</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token comment">// åœ¨è¿™é‡Œåšä¸€äº›å¼‚æ­¥çš„æ ¸å¿ƒä¸šåŠ¡é€»è¾‘</span>\n  <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n</code></pre></div><p>ä¹‹åä½ éœ€è¦æŠŠè¿™ä¸ª <code>BarService</code> åŠ åˆ° <code>Services</code> çš„æ¥å£ä¸­ï¼Œåœ¨ <code>src/main/services/index.ts</code> é‡Œï¼š</p><div class="language-ts"><pre><code><span class="token keyword">import</span> <span class="token punctuation">{</span> BarService <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;./BarService&#39;</span>\n\n<span class="token keyword">export</span> <span class="token keyword">interface</span> <span class="token class-name">Services</span> <span class="token punctuation">{</span>\n  <span class="token comment">// ... ä¸€äº›å…¶ä»–çš„ Services</span>\n  BarService<span class="token operator">:</span> BarService\n<span class="token punctuation">}</span>\n</code></pre></div><p>ä¹‹åï¼Œä½ éœ€è¦æŠŠå®ƒæ·»åŠ åˆ° <code>src/main/index.ts</code> çš„ <code>initializeServices</code> é‡Œï¼š</p><div class="language-ts"><pre><code><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">initializeServices</span><span class="token punctuation">(</span>logger<span class="token operator">:</span> Logger<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token function">initialize</span><span class="token punctuation">(</span><span class="token punctuation">{</span>\n    <span class="token comment">// ... å…¶ä»– services çš„åˆå§‹åŒ–</span>\n    BarService<span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">BarService</span><span class="token punctuation">(</span>logger<span class="token punctuation">)</span>\n  <span class="token punctuation">}</span><span class="token punctuation">)</span>\n<span class="token punctuation">}</span>\n</code></pre></div><p>ç°åœ¨è¿™ä¸ª <code>BarService</code> å·²ç»å¯ä»¥è¢«æ¸²æŸ“è¿›ç¨‹è°ƒç”¨äº†ï¼Œåªéœ€è¦é€šè¿‡ <code>useService(&#39;BarService&#39;)</code> å°±å¯ä»¥ï¼Œè¯¦æƒ…è¯·è§ <a href="#%E5%9C%A8%E6%B8%B2%E6%9F%93%E8%BF%9B%E7%A8%8B%E6%B5%8F%E8%A7%88%E5%99%A8%E4%B8%AD%E4%BD%BF%E7%94%A8%E6%9F%90%E4%B8%AA-service">Using Service in Renderer</a>.</p><h4 id="services-ä¹‹é—´çš„äº¤äº’"><a class="header-anchor" href="#services-ä¹‹é—´çš„äº¤äº’" aria-hidden="true">#</a> Services ä¹‹é—´çš„äº¤äº’</h4><p>å¦‚æœä½ åœ¨ä¸€ä¸ª <code>Service</code> ä¸­æƒ³ä½¿ç”¨å…¶ä»– <code>Service</code>ï¼Œæ¯”å¦‚ <code>FooService</code>ã€‚ä½ éœ€è¦ä½¿ç”¨ <code>@Inject</code> è£…é¥°å™¨ã€‚</p><div class="language-ts"><pre><code><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">BarService</span> <span class="token keyword">extends</span> <span class="token class-name">Service</span> <span class="token punctuation">{</span>\n  @<span class="token function">Inject</span><span class="token punctuation">(</span><span class="token string">&#39;FooService&#39;</span><span class="token punctuation">)</span>\n  <span class="token keyword">private</span> fooService<span class="token operator">:</span> FooService\n\n  <span class="token keyword">async</span> <span class="token function">doSomeCoreLogic</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span>fooService<span class="token punctuation">.</span><span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\n  <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n</code></pre></div><h4 id="åœ¨æ¸²æŸ“è¿›ç¨‹-æµè§ˆå™¨-ä¸­ä½¿ç”¨æŸä¸ª-service"><a class="header-anchor" href="#åœ¨æ¸²æŸ“è¿›ç¨‹-æµè§ˆå™¨-ä¸­ä½¿ç”¨æŸä¸ª-service" aria-hidden="true">#</a> åœ¨æ¸²æŸ“è¿›ç¨‹(æµè§ˆå™¨)ä¸­ä½¿ç”¨æŸä¸ª Service</h4><p>åœ¨ renderer è¿›ç¨‹ä¸­ï¼Œä½ å¯ä»¥é€šè¿‡ <code>useService(&#39;nameOfService&#39;)</code> ç›´æ¥è®¿é—®æ‰€æœ‰ service çš„æ‰€æœ‰å¼‚æ­¥ï¼ˆasyncï¼‰æ–¹æ³•ã€‚</p><p>è¿™æ˜¯ <a href="./.html">About.vue</a> é‡Œçš„ä¸€ä¸ªä¾‹å­ï¼Œå®ƒåœ¨ä½¿ç”¨ <code>BaseService</code>.</p><div class="language-vue"><pre><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>\n    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">alt</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>Vue logo<span class="token punctuation">&quot;</span></span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>../assets/logo.png<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>\n    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>Electron Version: {{ version }} <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>\n    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>Appdata Path: {{ path }} <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>\n    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>Running Platform: {{ platform }} <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>\n\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span>ts</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">\n<span class="token keyword">import</span> <span class="token punctuation">{</span> defineComponent<span class="token punctuation">,</span> reactive<span class="token punctuation">,</span> toRefs <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;vue&#39;</span>\n<span class="token keyword">import</span> <span class="token punctuation">{</span> useService <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;../hooks&#39;</span>\n\n<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">defineComponent</span><span class="token punctuation">(</span><span class="token punctuation">{</span>\n  <span class="token function">setup</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">const</span> <span class="token punctuation">{</span> getBasicInformation <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">useService</span><span class="token punctuation">(</span><span class="token string">&#39;BaseService&#39;</span><span class="token punctuation">)</span>\n    <span class="token keyword">const</span> data <span class="token operator">=</span> <span class="token function">reactive</span><span class="token punctuation">(</span><span class="token punctuation">{</span>\n      version<span class="token operator">:</span> <span class="token string">&#39;&#39;</span><span class="token punctuation">,</span>\n      path<span class="token operator">:</span> <span class="token string">&#39;&#39;</span><span class="token punctuation">,</span>\n      platform<span class="token operator">:</span> <span class="token string">&#39;&#39;</span>\n    <span class="token punctuation">}</span><span class="token punctuation">)</span>\n    <span class="token function">getBasicInformation</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> version<span class="token punctuation">,</span> platform<span class="token punctuation">,</span> root <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>\n      data<span class="token punctuation">.</span>version <span class="token operator">=</span> version\n      data<span class="token punctuation">.</span>path <span class="token operator">=</span> root\n      data<span class="token punctuation">.</span>platform <span class="token operator">=</span> platform\n    <span class="token punctuation">}</span><span class="token punctuation">)</span>\n    <span class="token keyword">return</span> <span class="token punctuation">{</span>\n      <span class="token operator">...</span><span class="token function">toRefs</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>\n    <span class="token punctuation">}</span>\n  <span class="token punctuation">}</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span>\n</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>\n</code></pre></div><h4 id="ç§»é™¤-service-æ¶æ„"><a class="header-anchor" href="#ç§»é™¤-service-æ¶æ„" aria-hidden="true">#</a> ç§»é™¤ Service æ¶æ„</h4><p>å¦‚æœä½ ä¸å–œæ¬¢ Service çš„è®¾è®¡ï¼Œä½ å¯ä»¥ç®€å•åœ°æŠŠä»–ä»¬ç§»é™¤æ‰ï¼š</p><ol><li>åˆ æ‰æ•´ä¸ª <code>src/main/services</code> æ–‡ä»¶å¤¹</li><li>åˆ æ‰ <code>src/main/index.ts</code> é‡Œé¢çš„ <code>import { initialize } from &#39;./services&#39;</code> å’Œ <code>initialize(logger)</code></li></ol><p>å½“ç„¶ä½ å¯ä»¥åœ¨ <code>npm init</code> ä¹‹åˆå°±é€‰æ‹©ä¸è¦ serviceã€‚</p><h3 id="é™æ€èµ„æº"><a class="header-anchor" href="#é™æ€èµ„æº" aria-hidden="true">#</a> é™æ€èµ„æº</h3><p>ä½ éœ€è¦æŠŠæ‰€æœ‰çš„çš„é™æ€èµ„æºæ”¾ç½®åœ¨ <code>static</code> æ–‡ä»¶å¤¹ä¸‹.</p><p>å¦‚æœä½ æƒ³åœ¨ main è¿›ç¨‹ä¸­ä½¿ç”¨å®ƒä»¬ï¼Œä½ åªéœ€è¦é€šè¿‡ <code>/@static/&lt;filename&gt;</code> è¿™ç§æ–¹å¼æ¥å¯¼å…¥.</p><p>ä¾‹å¦‚ï¼Œæˆ‘ä»¬æœ‰ä¸€ä¸ª <code>logo.png</code> æ–‡ä»¶æ”¾åœ¨é‡Œé¢ï¼Œæˆ‘ä»¬åœ¨ä»£ç ä¸­åªéœ€è¦åƒå¦‚ä¸‹æ–¹å¼å¯¼å…¥ï¼š</p><div class="language-ts"><pre><code><span class="token keyword">import</span> logoPath <span class="token keyword">from</span> <span class="token string">&#39;/@static/logo.png&#39;</span> <span class="token comment">// è¿™ä¸ªå°±æ˜¯ logo çš„ç»å¯¹è·¯å¾„</span>\n</code></pre></div><p>ç®¡ç†ä»¥ä¸Šè¡Œä¸ºçš„æ’ä»¶åœ¨ <code>scripts/rollup.static.plugin.js</code> ä¸­ã€‚</p><h3 id="preload-è„šæœ¬"><a class="header-anchor" href="#preload-è„šæœ¬" aria-hidden="true">#</a> Preload è„šæœ¬</h3><p>æ— è®ºä½ ç”¨ä¸ç”¨ Service çš„è®¾è®¡ï¼Œä½ å¯èƒ½éƒ½éœ€è¦è€ƒè™‘ preloadï¼Œpreload è®©ä½ èƒ½å¤Ÿåœ¨ renderer è¿›ç¨‹ä¸­æ’å…¥ä¸€äº›å®‰å…¨çš„å¯ä»¥è®¿é—® node æ¨¡å—çš„ä»£ç ã€‚</p><p><em>å¦‚æœä½ ä¸çŸ¥é“å•¥æ˜¯ preloadï¼Œä½ å¯ä»¥é˜…è¯» <a href="https://www.electronjs.org/docs/api/browser-window#new-browserwindowoptions" target="_blank" rel="noopener noreferrer">electron å…³äº BrowserWindow çš„å®˜æ–¹æ–‡æ¡£</a>å’Œ<a href="https://www.electronjs.org/docs/tutorial/security" target="_blank" rel="noopener noreferrer">å®˜æ–¹å®‰å…¨æŒ‡å—</a>.</em></p><p>åœ¨è¿™ä¸ªæ¨¡æ¿ä¸­ï¼Œæˆ‘ä»¬å·²ç»é…ç½®å¥½äº† preload çš„æ„å»ºæµç¨‹ï¼Œæ‰€æœ‰ preload éƒ½è¢«æ”¾åœ¨ <code>/src/preload</code> æ–‡ä»¶å¤¹ä¸‹ã€‚</p><p>ä½ å¿…é¡»å§ preload è„šæœ¬æ”¾ç½®åœ¨æ­¤æ–‡ä»¶å¤¹ä¸‹ã€‚å¦‚æœä½ æƒ³åœ¨åˆ›å»ºçª—å£çš„æ—¶å€™ä½¿ç”¨å®ƒï¼Œä½ éœ€è¦é€šè¿‡ <code>import preloadPath from &#39;/@preload/&lt;your-preload-file&gt;&#39;</code> è¿™ç§æ–¹å¼å¯¼å…¥å®ƒã€‚</p><p>ä¾‹å¦‚ï¼Œå¦‚æœä½ æ–°åŠ äº†ä¸€ä¸ª preload æ–‡ä»¶ï¼Œå«ä½œ <code>/src/preload/my-preload.ts</code>ï¼Œ ä½ å¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼åœ¨åˆ›å»º <code>BrowserWindow</code> æ—¶å¼•ç”¨å®ƒï¼š</p><div class="language-ts"><pre><code><span class="token keyword">import</span> myPreloadPath <span class="token keyword">from</span> <span class="token string">&#39;/@preload/my-preload&#39;</span>\n\n<span class="token keyword">new</span> <span class="token class-name">BrowserWindow</span><span class="token punctuation">(</span><span class="token punctuation">{</span>\n  webPreferences<span class="token operator">:</span> <span class="token punctuation">{</span>\n    preload<span class="token operator">:</span> myPreloadPath<span class="token punctuation">,</span>\n  <span class="token punctuation">}</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span>\n</code></pre></div><p>preload çš„ rollup é…ç½®åŒæ ·æ”¾ç½®åœ¨ <code>rollup.config.js</code> ä¸­ã€‚</p><p>åœ¨ <code>dist</code> æ–‡ä»¶å¤¹ä¸‹ï¼Œæ¯ä¸ª preload script ä¼šè¢«ç¼–è¯‘æˆ <code>dist/&lt;name&gt;.preload.js</code> çš„å½¢å¼ã€‚</p><p>ç®¡ç†ä»¥ä¸Šè¡Œä¸ºçš„æ’ä»¶æ”¾ç½®äº <code>scripts/rollup.preload.plugin.js</code>ã€‚</p><h3 id="åœ¨æ¸²æŸ“è¿›ç¨‹ä¸­ä½¿ç”¨-hooks-composable"><a class="header-anchor" href="#åœ¨æ¸²æŸ“è¿›ç¨‹ä¸­ä½¿ç”¨-hooks-composable" aria-hidden="true">#</a> åœ¨æ¸²æŸ“è¿›ç¨‹ä¸­ä½¿ç”¨ Hooks (Composable)</h3><p>Vue 3 çš„ä¸€å¤§ç‰¹æ€§å°±æ˜¯ <a href="https://v3.cn.vuejs.org/api/composition-api.html" target="_blank" rel="noopener noreferrer">ç»„åˆå¼ API</a>ã€‚ä½ å¯ä»¥é€šè¿‡ç»„åˆæ¨¡å¼ï¼Œå°†å„ç§ç®€å•é€»è¾‘åœ¨ <code>setup</code> å‡½æ•°ä¸­æ‹¼è£…å‡ºå¤æ‚çš„ä¸šåŠ¡é€»è¾‘ã€‚è¿™äº›ç»„åˆå‡½æ•°éƒ½é»˜è®¤æ”¾åœ¨ <code>/src/renderer/hooks</code> ä¸­ã€‚</p><p>ä¸‹é¢å°±æ˜¯å®˜æ–¹æ–‡æ¡£ä¸­çš„ä¾‹å­ï¼Œä½ åœ¨ <code>/src/renderer/hooks/mouse.ts</code> é‡Œæœ‰ä»¥ä¸‹ä»£ç ï¼š</p><div class="language-ts"><pre><code><span class="token keyword">import</span> <span class="token punctuation">{</span> ref<span class="token punctuation">,</span> onMounted<span class="token punctuation">,</span> onUnmounted <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;vue&#39;</span>\n\n<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">useMousePosition</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token keyword">const</span> x <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>\n  <span class="token keyword">const</span> y <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>\n\n  <span class="token keyword">function</span> <span class="token function">update</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    x<span class="token punctuation">.</span>value <span class="token operator">=</span> e<span class="token punctuation">.</span>pageX\n    y<span class="token punctuation">.</span>value <span class="token operator">=</span> e<span class="token punctuation">.</span>pageY\n  <span class="token punctuation">}</span>\n\n  <span class="token function">onMounted</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>\n    window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&#39;mousemove&#39;</span><span class="token punctuation">,</span> update<span class="token punctuation">)</span>\n  <span class="token punctuation">}</span><span class="token punctuation">)</span>\n\n  <span class="token function">onUnmounted</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>\n    window<span class="token punctuation">.</span><span class="token function">removeEventListener</span><span class="token punctuation">(</span><span class="token string">&#39;mousemove&#39;</span><span class="token punctuation">,</span> update<span class="token punctuation">)</span>\n  <span class="token punctuation">}</span><span class="token punctuation">)</span>\n\n  <span class="token keyword">return</span> <span class="token punctuation">{</span> x<span class="token punctuation">,</span> y <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n</code></pre></div><p>ä½ å¯ä»¥æŠŠ <code>mouse.ts</code> åœ¨ <code>/src/renderer/hooks/index.ts</code> ä¸­å¯¼å‡ºï¼š</p><div class="language-ts"><pre><code><span class="token comment">// å…¶ä»–å¯¼å‡º...</span>\n\n<span class="token keyword">export</span> <span class="token operator">*</span> <span class="token keyword">from</span> <span class="token string">&#39;./mouse.ts&#39;</span>\n</code></pre></div><p>ç„¶åä½ åœ¨ <code>vue</code> æ–‡ä»¶ä¸­ï¼Œå°±å¯ä»¥è¿™æ ·æ¥å¯¼å…¥ï¼š</p><div class="language-vue"><pre><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>\n  ...template content\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span>ts</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">\n<span class="token keyword">import</span> <span class="token punctuation">{</span> defineComponent <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;vue&#39;</span>\n<span class="token keyword">import</span> <span class="token punctuation">{</span> useMousePosition <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;/@/hooks&#39;</span>\n\n<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">defineComponent</span><span class="token punctuation">(</span><span class="token punctuation">{</span>\n  <span class="token function">setup</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">const</span> <span class="token punctuation">{</span> x<span class="token punctuation">,</span> y <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">useMousePosition</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\n    <span class="token comment">// other logic</span>\n    <span class="token keyword">return</span> <span class="token punctuation">{</span> x<span class="token punctuation">,</span> y <span class="token punctuation">}</span>\n  <span class="token punctuation">}</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span>\n</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>\n</code></pre></div><h3 id="åœ¨æ¸²æŸ“è¿›ç¨‹ä¸­ä½¿ç”¨-electron-api"><a class="header-anchor" href="#åœ¨æ¸²æŸ“è¿›ç¨‹ä¸­ä½¿ç”¨-electron-api" aria-hidden="true">#</a> åœ¨æ¸²æŸ“è¿›ç¨‹ä¸­ä½¿ç”¨ Electron API</h3><p>æ­¤é¡¹ç›®åœ¨é»˜è®¤æƒ…å†µä¸‹å·²ç»å°è£…äº†ä¸€äº› electron API ä¾› renderer è¿›ç¨‹ä½¿ç”¨ï¼Œä¾‹å¦‚ <code>useShell</code>, <code>useClipboard</code>, <code>useIpc</code> å’Œ <code>useDialog</code>ã€‚</p><p><em>è¿™äº› API æ˜¯é€šè¿‡åŠ è½½ <code>static/preload.js</code> æ¥å®ç°çš„ã€‚å¦‚æœä½ æŠŠ preload åœ¨åˆ›å»º BrowserWindow çš„æ—¶å€™ç»™ç§»é™¤äº†ï¼Œåœ¨ renderer è¿›ç¨‹è¿™äº›å°±ç”¨ä¸äº†äº†ã€‚</em></p><div class="language-ts"><pre><code><span class="token keyword">import</span> <span class="token punctuation">{</span> defineComponent <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;vue&#39;</span>\n<span class="token keyword">import</span> <span class="token punctuation">{</span> useShell <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;/@/hooks&#39;</span>\n\n<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">defineComponent</span><span class="token punctuation">(</span><span class="token punctuation">{</span>\n  <span class="token function">setup</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">const</span> shell <span class="token operator">=</span> <span class="token function">useShell</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// è¿™ä¸ªç­‰ä»·äº import { shell } from &#39;electron&#39;</span>\n  <span class="token punctuation">}</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span>\n</code></pre></div><p>ä¸€èˆ¬çš„ use é£æ ¼çš„ electron API éƒ½ç­‰ä»·äºç›´æ¥ä» electron importï¼Œä½†æ˜¯ <code>useDialog</code> æ˜¯å”¯ä¸€ä¾‹å¤–ï¼Œä½ åªèƒ½åœ¨å…¶ä¸­ä½¿ç”¨ <code>async</code> çš„ APIã€‚</p><h3 id="ç®¡ç†ä¾èµ–"><a class="header-anchor" href="#ç®¡ç†ä¾èµ–" aria-hidden="true">#</a> ç®¡ç†ä¾èµ–</h3><p>å¦‚æœä½ æƒ³æ·»åŠ æ–°çš„ npm åŒ…ä½œä¸ºä¾èµ–ä½¿ç”¨ï¼Œä½ éœ€è¦æ³¨æ„è¿™ä¸ªä¾èµ–æ˜¯ä¸æ˜¯ä¸€ä¸ªåŸºäº nodejs çš„æ¨¡å—ã€‚å¦‚æœå®ƒæ˜¯ä¸€ä¸ª nodejs çš„åŒ…ï¼Œä½ éœ€è¦æŠŠè¿™ä¸ªåŒ…åæ”¾è¿› <code>package.json</code> çš„ <code>external</code> åˆ—è¡¨ä¸­ã€‚è¿™ä¸ªåˆ—è¡¨æ˜¯ç”¨äºå‘Šè¯‰ vite ä¸è¦ä¼˜åŒ–æŸäº›ä¾èµ–ï¼Œå¦‚æœä½ ä¸åœ¨è¿™é‡Œå‰”é™¤ä»–ä»¬ï¼Œviteå°±ä¼šæŠ±æ€¨è¯´â€œæˆ‘ä¼˜åŒ–ä¸äº†è¿™äº›ï¼â€ä¹‹ç±»çš„è¯ã€‚</p><div class="language-json"><pre><code><span class="token punctuation">{</span>\n  <span class="token comment">// ...other package.json content</span>\n  <span class="token property">&quot;dependencies&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>\n    <span class="token comment">// ...other dependencies</span>\n    <span class="token property">&quot;a-nodejs-package&quot;</span><span class="token operator">:</span> <span class="token string">&quot;&lt;version&gt;&quot;</span>\n  <span class="token punctuation">}</span><span class="token punctuation">,</span>\n  <span class="token property">&quot;external&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>\n    <span class="token comment">// ...other existed excluded packages</span>\n    <span class="token string">&quot;a-nodejs-package&quot;</span> <span class="token comment">// your new package</span>\n  <span class="token punctuation">]</span><span class="token punctuation">,</span>\n  <span class="token comment">// ...rest of package.json</span>\n<span class="token punctuation">}</span>\n</code></pre></div><p>å½“ç„¶å¦‚æœè¿™ä¸ªä¾èµ–æ˜¯çº¯ JS å®ç°ï¼Œä½ å°±ä¸éœ€è¦æŠŠå®ƒåŠ åˆ°è¿™é‡Œé¢äº†ã€‚</p><h4 id="åŸç”Ÿ-native-ä¾èµ–"><a class="header-anchor" href="#åŸç”Ÿ-native-ä¾èµ–" aria-hidden="true">#</a> åŸç”Ÿ (Native) ä¾èµ–</h4><p>å¦‚æœä½ éœ€è¦ä½¿ç”¨ä¸€äº›åŸç”Ÿä¾èµ–ï¼ˆéœ€è¦åœ¨å®‰è£…æ—¶ä»æºç é‡æ–°æ„å»ºæˆäºŒè¿›åˆ¶çš„ä¾èµ–ï¼‰ï¼Œé€šå¸¸ä½ éœ€è¦ <a href="https://github.com/nodejs/node-gyp" target="_blank" rel="noopener noreferrer">node-gyp</a>ï¼Œä½†æ˜¯ <code>electron-builder</code> ä¼šè‡ªåŠ¨å¸®ä½ é‡æ–°æ„å»º electron ç‰ˆæœ¬çš„äºŒè¿›åˆ¶æ–‡ä»¶ã€‚æ‰€ä»¥ä½ ä¸€èˆ¬ä¸éœ€è¦å¤ªåœ¨æ„è¿™ä¸ªã€‚è¯·æ³¨æ„ï¼Œå¦‚æœä½ åœ¨ç”¨ Windowsï¼Œä½ å¯èƒ½éœ€è¦å®‰è£… <a href="https://github.com/felixrieseberg/windows-build-tools" target="_blank" rel="noopener noreferrer">windows-build-tools</a> æ¥å¸®åŠ©ä½ å®‰è£…æ„å»ºä¾èµ–çš„ç¯å¢ƒã€‚</p><h4 id="è‡ªå¸¦äºŒè¿›åˆ¶çš„ä¾èµ–"><a class="header-anchor" href="#è‡ªå¸¦äºŒè¿›åˆ¶çš„ä¾èµ–" aria-hidden="true">#</a> è‡ªå¸¦äºŒè¿›åˆ¶çš„ä¾èµ–</h4><p>æœ‰ä¸€äº› package ä¸­å«æœ‰å·²ç»ç¼–è¯‘å¥½çš„äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œå¯¹äºè¿™ç§ package æˆ‘ä»¬ä¸ä½†éœ€è¦æŠŠå®ƒæ”¾è¿› <code>external</code> ä¸­ï¼Œè¿˜éœ€è¦å¯¹ electron-builder çš„é…ç½®ç¨åŠ æ”¹åŠ¨ã€‚å…·ä½“ç»†èŠ‚è¯·å‚è§ <a href="#%E5%9C%A8%E6%9E%84%E5%BB%BA%E4%B8%AD%E5%89%94%E9%99%A4%E6%9F%90%E4%BA%9B%E5%85%B7%E4%BD%93%E6%96%87%E4%BB%B6">åœ¨æ„å»ºä¸­å‰”é™¤æŸäº›å…·ä½“æ–‡ä»¶</a> ç« èŠ‚ã€‚å½“ç„¶è¿™å¯¹äºæ­£å¸¸å¼€å‘æµç¨‹å¹¶æ²¡æœ‰ä»€ä¹ˆå½±å“ã€‚</p><h3 id="æ·»åŠ ä¸€ä¸ªæ–°çš„çª—å£"><a class="header-anchor" href="#æ·»åŠ ä¸€ä¸ªæ–°çš„çª—å£" aria-hidden="true">#</a> æ·»åŠ ä¸€ä¸ªæ–°çš„çª—å£</h3><ol><li>åœ¨ <code>src/renderer</code> ä¸‹æ·»åŠ ä¸€ä¸ªæ–°çš„ html æ–‡ä»¶</li><li>åœ¨æ–°æ·»åŠ çš„ html æ–‡ä»¶ä¸­å¼•ç”¨ä½ æ–°å†™çš„ ts/js æ–‡ä»¶</li><li>åœ¨ä¸»è¿›ç¨‹ <code>main/index.ts</code> ä¸­åŠ å…¥ä¸€æ®µåˆ›å»ºæ­¤çª—å£çš„ä»£ç </li></ol><p>ä¾‹å¦‚ä½ åœ¨ <code>src/renderer</code> ä¸‹é¢æ–°å¢åŠ äº† <code>side.html</code> ï¼Œä½ éœ€è¦åœ¨ <code>index.ts</code> ä¸­åŠ å…¥ç±»ä¼¼ä»¥ä¸‹ä»£ç ï¼š</p><div class="language-ts"><pre><code><span class="token keyword">import</span> preload <span class="token keyword">from</span> <span class="token string">&#39;/@preload/index&#39;</span>\n\n<span class="token comment">// è¿™ä¸ªæ–¹æ³•åº”è¯¥åœ¨å¯åŠ¨çš„æ—¶å€™è¢«è°ƒç”¨</span>\n<span class="token keyword">function</span> <span class="token function">createANewWindow</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token comment">// è¿™éƒ¨åˆ†å’Œä¹‹å‰éƒ½ä¸€æ ·ï¼Œæ ¹æ®è‡ªå·±éœ€æ±‚æ”¹</span>\n  <span class="token keyword">const</span> win <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BrowserWindow</span><span class="token punctuation">(</span><span class="token punctuation">{</span>\n    height<span class="token operator">:</span> <span class="token number">600</span><span class="token punctuation">,</span>\n    width<span class="token operator">:</span> <span class="token number">300</span><span class="token punctuation">,</span>\n    webPreferences<span class="token operator">:</span> <span class="token punctuation">{</span>\n      preload<span class="token punctuation">,</span>\n      contextIsolation<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>\n      nodeIntegration<span class="token operator">:</span> <span class="token boolean">false</span>\n    <span class="token punctuation">}</span>\n  <span class="token punctuation">}</span><span class="token punctuation">)</span>\n\n  <span class="token comment">// __windowUrls.side å°±æ˜¯æŒ‡å‘ä½ æ–°æ·»åŠ çš„ html çš„ url</span>\n  win<span class="token punctuation">.</span><span class="token function">loadURL</span><span class="token punctuation">(</span>__windowUrls<span class="token punctuation">.</span>side<span class="token punctuation">)</span>\n<span class="token punctuation">}</span>\n\n</code></pre></div><p>åœ¨ <code>scripts/vite.config.js</code> ä¸­ä¼šè‡ªåŠ¨æ‰«æ <code>src/renderer</code> ä¸‹çš„æ‰€æœ‰ html æ–‡ä»¶ï¼Œæ‰€ä»¥ä¸€èˆ¬æ¥è¯´ä½ ä¸éœ€è¦æ”¹ vite çš„é…ç½®æ–‡ä»¶ã€‚ å½“ç„¶ä½ å¯ä»¥å‚ç…§ <a href="https://vitejs.dev/guide/build.html#multi-page-app" target="_blank" rel="noopener noreferrer">vite çš„å®˜æ–¹æ–‡æ¡£</a>æ¥æ›´åŠ è‡ªå®šä¹‰å¤šé¡µé¢çš„åŠŸèƒ½ã€‚</p><h3 id="å¤šçº¿ç¨‹-thread-worker"><a class="header-anchor" href="#å¤šçº¿ç¨‹-thread-worker" aria-hidden="true">#</a> å¤šçº¿ç¨‹ (Thread Worker)</h3><p>å¦‚æœä½ æƒ³åœ¨ main è¿›ç¨‹ä¸­ä½¿ç”¨ nodejs çš„ <a href="https://nodejs.org/api/worker_threads.html" target="_blank" rel="noopener noreferrer">worker_threads</a>ï¼ŒWorker è„šæœ¬éœ€è¦è¢«ç‹¬ç«‹åŠ è½½ã€‚ æˆ‘ä»¬åœ¨è¿™é‡Œå·²ç»é›†æˆäº† Worker è„šæœ¬çš„æ‰“åŒ…æ„å»ºæµç¨‹ã€‚é€šå¸¸æ¥è®²ï¼Œä½ ä¸éœ€è¦ä¿®æ”¹æ„å»ºé…ç½®å°±å¯ä»¥æ·»åŠ æ–°çš„ Workerã€‚</p><p>å¦‚æœä½ æƒ³æŠŠä¸€ä¸ªæ–‡ä»¶å¯¼å…¥ä¸º <code>worker_thread</code> ä½ åªéœ€è¦åœ¨å¯¼å…¥è·¯å¾„åé¢åŠ ä¸Š <code>?worker</code>ã€‚</p><p>å¦‚æœä½ æ·»åŠ äº†ä¸€ä¸ªå« <code>src/main/workers/sha256.ts</code> çš„ Worker è„šæœ¬ï¼Œä½ å¯ä»¥è¿™æ ·æ¥åˆ›å»ºä¸€ä¸ªä½¿ç”¨æ­¤è„šæœ¬çš„ Workerï¼š</p><div class="language-ts"><pre><code><span class="token keyword">import</span> createSha256Worker <span class="token keyword">from</span> <span class="token string">&#39;./workers/sha256?worker&#39;</span>\n<span class="token keyword">import</span> <span class="token punctuation">{</span> Worker <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;worker_threads&#39;</span>\n\n<span class="token keyword">const</span> worker<span class="token operator">:</span> Worker <span class="token operator">=</span> <span class="token function">createSha256Worker</span><span class="token punctuation">(</span><span class="token comment">/* options */</span><span class="token punctuation">)</span>\n</code></pre></div><p>Worker çš„è„šæœ¬ä¼šå’Œæ™®é€šçš„ main è¿›ç¨‹ä»£ç ä¸€èµ·åœ¨ rollup ä¸­ç¼–è¯‘ï¼Œåœ¨ <code>rollup.config.js</code> ä¸­ä»–ä»¬å…±äº«ç›¸åŒçš„ rollup é…ç½®ã€‚</p><p>åœ¨ <code>dist</code> æ–‡ä»¶å¤¹ä¸‹, Worker çš„è„šæœ¬ä¼šè¢«ç¼–è¯‘æˆ <code>dist/&lt;name&gt;.worker.js</code>ã€‚</p><h3 id="åœ¨-vscode-ä¸­-debug"><a class="header-anchor" href="#åœ¨-vscode-ä¸­-debug" aria-hidden="true">#</a> åœ¨ VSCode ä¸­ Debug</h3><p>æœ¬é¡¹ç›®å†…ç½®é…ç½®å¥½çš„ vscode debug é…ç½®ã€‚ä½ ä¼šåœ¨ .vscode/launch.json ä¸­çœ‹åˆ°ä»¥ä¸‹ä¸‰ä¸ªé…ç½®</p><ol><li>Electron: Main (attach)</li><li>Electron: Renderer (attach)</li><li>Electron: Main &amp; Renderer (attach)</li></ol><div class="language-json"><pre><code><span class="token punctuation">{</span>\n    <span class="token property">&quot;version&quot;</span><span class="token operator">:</span> <span class="token string">&quot;0.2.0&quot;</span><span class="token punctuation">,</span>\n    <span class="token property">&quot;configurations&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>\n        <span class="token punctuation">{</span>\n            <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Electron: Main (attach)&quot;</span><span class="token punctuation">,</span>\n            <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;node&quot;</span><span class="token punctuation">,</span>\n            <span class="token property">&quot;request&quot;</span><span class="token operator">:</span> <span class="token string">&quot;attach&quot;</span><span class="token punctuation">,</span>\n            <span class="token property">&quot;cwd&quot;</span><span class="token operator">:</span> <span class="token string">&quot;${workspaceFolder}&quot;</span><span class="token punctuation">,</span>\n            <span class="token property">&quot;outFiles&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>\n                <span class="token string">&quot;${workspaceFolder}/dist/**/*.js&quot;</span>\n            <span class="token punctuation">]</span><span class="token punctuation">,</span>\n            <span class="token property">&quot;smartStep&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>\n            <span class="token property">&quot;sourceMaps&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>\n            <span class="token property">&quot;protocol&quot;</span><span class="token operator">:</span> <span class="token string">&quot;inspector&quot;</span><span class="token punctuation">,</span>\n            <span class="token property">&quot;port&quot;</span><span class="token operator">:</span> <span class="token number">5858</span><span class="token punctuation">,</span>\n            <span class="token property">&quot;timeout&quot;</span><span class="token operator">:</span> <span class="token number">20000</span>\n        <span class="token punctuation">}</span><span class="token punctuation">,</span>\n        <span class="token punctuation">{</span>\n            <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Electron: Renderer (attach)&quot;</span><span class="token punctuation">,</span>\n            <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;chrome&quot;</span><span class="token punctuation">,</span>\n            <span class="token property">&quot;request&quot;</span><span class="token operator">:</span> <span class="token string">&quot;attach&quot;</span><span class="token punctuation">,</span>\n            <span class="token property">&quot;port&quot;</span><span class="token operator">:</span> <span class="token number">9222</span><span class="token punctuation">,</span>\n            <span class="token property">&quot;webRoot&quot;</span><span class="token operator">:</span> <span class="token string">&quot;${workspaceFolder}&quot;</span><span class="token punctuation">,</span>\n            <span class="token property">&quot;timeout&quot;</span><span class="token operator">:</span> <span class="token number">15000</span>\n        <span class="token punctuation">}</span><span class="token punctuation">,</span>\n    <span class="token punctuation">]</span><span class="token punctuation">,</span>\n    <span class="token property">&quot;compounds&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>\n        <span class="token punctuation">{</span>\n            <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Electron: Main &amp; Renderer (attach)&quot;</span><span class="token punctuation">,</span>\n            <span class="token property">&quot;configurations&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;Electron: Main (attach)&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Electron: Renderer (attach)&quot;</span><span class="token punctuation">]</span>\n        <span class="token punctuation">}</span>\n    <span class="token punctuation">]</span>\n<span class="token punctuation">}</span>\n</code></pre></div><p>å¦‚æœä½ çœ‹å¾—æ‡‚çš„è¯å°±æ¯”è¾ƒæ¸…æ™°äº†. ç¬¬ä¸€ä¸ªæ˜¯ attach åˆ° Electron çš„ main è¿›ç¨‹ä¸Šã€‚ç¬¬äºŒä¸ªæ˜¯ attach åˆ° Renderer è¿›ç¨‹ä¸Šï¼ˆéœ€è¦ vscode å®‰è£… Chrome Debugger æ’ä»¶ï¼‰ã€‚ç¬¬ä¸‰ä¸ªåˆ™æ˜¯è¿™ä¿©çš„åˆä½“ï¼Œä¸¤ä¸ªéƒ½ attach ä¸Šã€‚</p><p>æ³¨æ„ï¼Œè¿™äº›é…ç½®éƒ½æ˜¯ attach æ¨¡å¼ï¼Œä½ éœ€è¦å…ˆé€šè¿‡ <code>npm run dev</code> å¯åŠ¨ Electron åä½¿ç”¨ã€‚</p><h3 id="å¯é€‰é¡¹-åœ¨æ¸²æŸ“è¿›ç¨‹ä¸­ä½¿ç”¨-node-æ¨¡å—"><a class="header-anchor" href="#å¯é€‰é¡¹-åœ¨æ¸²æŸ“è¿›ç¨‹ä¸­ä½¿ç”¨-node-æ¨¡å—" aria-hidden="true">#</a> å¯é€‰é¡¹: åœ¨æ¸²æŸ“è¿›ç¨‹ä¸­ä½¿ç”¨ Node æ¨¡å—</h3><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œæ¸²æŸ“è¿›ç¨‹å°±æ˜¯ä¸ªæ™®é€šçš„å‰ç«¯æµè§ˆå™¨ç¯å¢ƒã€‚ä½ ä¸èƒ½åœ¨é‡Œé¢è®¿é—® nodejs æ¨¡å—ã€‚</p><p>å¦‚æœä½ æ˜¯åœ¨æƒ³åœ¨é‡Œé¢ç”¨ node æ¨¡å—ï¼Œæˆ–è€…ä½ å¯¹ service çš„è®¾è®¡æ„Ÿåˆ°åŒå€¦ï¼Œä½ å¯ä»¥ç›´æ¥åœ¨ä½ åˆ›å»º BrowserWindow ä¹‹åˆå¼€å¯ <code>nodeIntegration</code>ã€‚è¿™ä¸ªå±æ€§å¼€å¯ä¼šè®©ä½ çš„ renderer è¿›ç¨‹ä¹Ÿèƒ½è®¿é—® nodeã€‚</p><p>æ¯”å¦‚ä½ å¯ä»¥æœ‰å¦‚ä¸‹ä»£ç è®©æˆ‘ä»¬çš„ä¸»çª—å£èƒ½è®¿é—® nodeï¼š</p><div class="language-ts"><pre><code><span class="token keyword">const</span> mainWindow <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BrowserWindow</span><span class="token punctuation">(</span><span class="token punctuation">{</span>\n  height<span class="token operator">:</span> <span class="token number">600</span><span class="token punctuation">,</span>\n  width<span class="token operator">:</span> <span class="token number">800</span><span class="token punctuation">,</span>\n  webPreferences<span class="token operator">:</span> <span class="token punctuation">{</span>\n    preload<span class="token operator">:</span> <span class="token function">join</span><span class="token punctuation">(</span>__static<span class="token punctuation">,</span> <span class="token string">&#39;preload.js&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n    nodeIntegration<span class="token operator">:</span> <span class="token boolean">true</span> <span class="token comment">// è¿™è®©è¿™ä¸ªæµè§ˆå™¨å¯ä»¥è®¿é—® node</span>\n  <span class="token punctuation">}</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span>\n</code></pre></div><h2 id="æ„å»º"><a class="header-anchor" href="#æ„å»º" aria-hidden="true">#</a> æ„å»º</h2><p>æ­¤é¡¹ç›®çš„æ„å»ºæ˜¯ç›´æ¥ä½¿ç”¨ <a href="https://github.com/electron-userland/electron-builder" target="_blank" rel="noopener noreferrer">electron-builder</a> æ¥è¾¾æˆçš„ã€‚å®ƒçš„é…ç½®ä¸»è¦æ”¾åœ¨ <a href="https://github.com/ci010/electron-vue-next/tree/master/electron-vue-next/scripts/build.base.config.js" target="_blank" rel="noopener noreferrer">scripts/build.base.config.js</a> æ–‡ä»¶ä¸­ã€‚å½“ç„¶ä½ å¯ä»¥å‚è€ƒ electron-builder çš„<a href="https://www.electron.build/" target="_blank" rel="noopener noreferrer">å®˜æ–¹æ–‡æ¡£</a>æ¥ä½¿ç”¨ã€‚</p><h3 id="ç¼–è¯‘æµç¨‹"><a class="header-anchor" href="#ç¼–è¯‘æµç¨‹" aria-hidden="true">#</a> ç¼–è¯‘æµç¨‹</h3><p>é¦–å…ˆï¼Œæˆ‘ä»¬ä¼šå°† typescript/vue çš„æºç é€šè¿‡ rollup ä»¥ production æ¨¡å¼ç¼–è¯‘æˆ JavaScriptã€‚rollup å¯¹ä¸»è¿›ç¨‹çš„ç¼–è¯‘é…ç½®åœ¨ <a href="https://github.com/ci010/electron-vue-next/tree/master/electron-vue-next/scripts/rollup.config.js" target="_blank" rel="noopener noreferrer">rollup.config.js</a> ä¸­ï¼Œå®ƒä¼šæŠŠç¼–è¯‘å‡ºæ¥çš„ç»“æœè¾“å‡ºåˆ° <code>dist/index.js</code>ã€‚</p><p>æ³¨æ„ï¼Œå› ä¸º rollup æ˜¯åŸºäº esm çš„ï¼Œå¯¹å¾ªç¯ä¾èµ–çš„å¤„ç†æ²¡æ³•åƒ webpack é‚£æ ·ç†æƒ³ï¼Œæ‰€ä»¥åœ¨å°è¯•æ‰“åŒ…ä¸å°‘ nodejs çš„ package æ—¶ä¼šé‡åˆ°å¾ªç¯ä¾èµ–çš„é—®é¢˜ã€‚è€Œä½ è‡ªå·±å¯¹è¿™äº› package æ²¡æœ‰æŒæ§ ï¼ˆwebpack ä¸€èˆ¬èƒ½å¤„ç†è¿™ç§å¾ªç¯ä¾èµ–çš„é—®é¢˜ï¼Œå¹¶ä¸ä¼šç›´æ¥å¤±è´¥æ‰ï¼‰ï¼Œæ‰€ä»¥æ­¤é¡¹ç›®é»˜è®¤å¸¦çš„ rollup æ„å»ºè„šæœ¬æ˜¯ä¸ä¼šæ‰“åŒ… main ä¸­ä½¿ç”¨çš„ nodejs ä¾èµ–çš„ï¼Œä½ åªè¦åœ¨ <code>package.json</code> ä¸­æŠŠä»–ä»¬æ ‡æ³¨æˆ <code>external</code>ï¼Œè¿™äº›ä¾èµ–å°±ä¼šä»¥ <code>node_modules</code> çš„å½¢å¼å­˜åœ¨äºæˆ‘ä»¬çš„æ„å»ºè¾“å‡ºçš„ asar ä¸­ã€‚æ‰€ä»¥å½“ä½ å‘ç° <code>index.js</code> ä¸­æ²¡æœ‰æ‰“åŒ… nodejs çš„ä¾èµ–ä»£ç ä¹Ÿåˆ«æ„Ÿåˆ°å¥‡æ€ªå°±æ˜¯äº†ã€‚</p><p>è€Œæ¸²æŸ“è¿›ç¨‹çš„ç¼–è¯‘é…ç½®æ”¾åœ¨ <a href="https://github.com/ci010/electron-vue-next/tree/master/electron-vue-next/scripts/vite.config.js" target="_blank" rel="noopener noreferrer">vite.config.js</a> é‡Œï¼Œå®ƒä¼šå°†ç»“æœè¾“å‡ºåˆ° <code>dist/renderer/*</code> é‡Œã€‚</p><h4 id="åŠ é€Ÿç¼–è¯‘"><a class="header-anchor" href="#åŠ é€Ÿç¼–è¯‘" aria-hidden="true">#</a> åŠ é€Ÿç¼–è¯‘</h4><p>å¦‚æœä½ è§‰å¾—ç¼–è¯‘æ—¶é—´å®åœ¨æ˜¯å¤ªé•¿äº†ï¼Œä¸€èˆ¬æ¥è¯´è¿™ç§æƒ…å†µéƒ½æ˜¯å› ä¸º main è¿›ç¨‹çš„ä»£ç è¦ç±»å‹æ£€æŸ¥å¾ˆä¹…ã€‚</p><p>ä½ å¯ä»¥åœ¨ rollup.config.js é‡Œè®¾ç½® typescript æ’ä»¶çš„å‚æ•°æ¥è·³è¿‡ç±»å‹æ£€æŸ¥ï¼š</p><div class="language-ts"><pre><code><span class="token function">pluginTypescript</span><span class="token punctuation">(</span><span class="token punctuation">{</span>\n  tsconfig<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">&#39;../src/main/tsconfig.json&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">&#39;../src/preload/tsconfig.json&#39;</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>\n  wait<span class="token operator">:</span> <span class="token boolean">false</span> <span class="token comment">// è®¾ç½®è¿™ä¸ªä¼šè®© rollup build è·³è¿‡ç±»å‹æ£€æŸ¥çš„ç»“æœ</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n</code></pre></div><p>å…³æ‰ wait ä½ è¿˜æ˜¯èƒ½çœ‹åˆ°ç±»å‹æ£€æŸ¥çš„ç»“æœï¼Œä½†æ˜¯è¿™ä¸ªç»“æœçš„å¤±è´¥ä¸ä¼šå†å½±å“ä½ çš„ rollup build äº†ã€‚</p><p>å¦‚æœä½ å…³äº†è¿˜æ˜¯è§‰å¾—æ…¢ï¼Œä½ å¯ä»¥æŠŠè¿™ä¸ªæ’ä»¶ç§»é™¤å‡º rollup.config.js</p><h3 id="åœ¨æ„å»ºä¸­å‰”é™¤æŸäº›å…·ä½“æ–‡ä»¶"><a class="header-anchor" href="#åœ¨æ„å»ºä¸­å‰”é™¤æŸäº›å…·ä½“æ–‡ä»¶" aria-hidden="true">#</a> åœ¨æ„å»ºä¸­å‰”é™¤æŸäº›å…·ä½“æ–‡ä»¶</h3><p>é€šå¸¸æ¥è®²ï¼Œå¦‚æœä½ çš„ <code>dependencies</code> å’Œ <code>external</code> é…ç½®æ­£ç¡®ï¼Œä½ ä¸éœ€è¦å¤ªæ‹…å¿ƒæ„å»ºçš„é—®é¢˜ã€‚ä½†æ˜¯æœ‰ä¸€äº›ä¾èµ–åŒ…å«äº†å·²ç»ç¼–è¯‘å¥½çš„äºŒè¿›åˆ¶ã€‚ä½ å¯èƒ½å¸Œæœ›æ­£ç¡®æ‰“åŒ…è¿™äº›é¢„ç¼–è¯‘çš„äºŒè¿›åˆ¶æ–‡ä»¶ã€‚</p><p>ä¾‹å¦‚, <a href="https://github.com/onikienko/7zip-min" target="_blank" rel="noopener noreferrer">7zip-min</a>:</p><p>å› ä¸ºå®ƒå¼•ç”¨äº† <code>7zip-bin</code>ï¼Œè€Œ <code>7zip-bin</code> è‡ªå¸¦äº†é’ˆå¯¹å¤šå¹³å°çš„äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œæˆ‘ä»¬éœ€è¦å¦¥å–„å¤„ç†è¿™äº›å·²ç» build å¥½çš„äºŒè¿›åˆ¶æ–‡ä»¶ã€‚æˆ‘ä»¬è‡ªç„¶ä¸å¸Œæœ›åœ¨æŸä¸€ä¸ªå¹³å°çš„æ„ä»¶ä¸­çœ‹åˆ°å¦ä¸€ä¸ªå¹³å°çš„äºŒè¿›åˆ¶æ–‡ä»¶ã€‚ æ›´æ”¹ electron-builder çš„æ„å»ºé…ç½®: <code>build.base.config.js</code></p><div class="language-js"><pre><code>  asarUnpack<span class="token operator">:</span> <span class="token punctuation">[</span>\n    <span class="token string">&quot;node_modules/7zip-bin/**/*&quot;</span>\n  <span class="token punctuation">]</span><span class="token punctuation">,</span>\n</code></pre></div><p>å°†ä»–ä»¬æ·»åŠ åˆ° <code>asarUnpack</code> ä¸­æ¥ä¿è¯ electron-builder åœ¨å®‰è£…åä¼šæ­£ç¡®è§£å‹è¿™äº›äºŒè¿›åˆ¶æ–‡ä»¶ã€‚</p><p>ä½ è¿˜éœ€è¦åœ¨ <code>build.config.js</code> ä¸­ä¸ºæ¯ä¸ªå¹³å°é…ç½® <code>files</code>ï¼Œè¿™æ ·å°±ä¸ä¼šè®©æŸä¸ªå¹³å°çš„å‡ºç°åœ¨å®ƒä¸è¯¥å‡ºç°çš„åœ°æ–¹äº†ï¼š</p><div class="language-js"><pre><code>  mac<span class="token operator">:</span> <span class="token punctuation">{</span>\n    <span class="token comment">// ... å…¶ä»– mac é…ç½®</span>\n    files<span class="token operator">:</span> <span class="token punctuation">[</span>\n      <span class="token string">&quot;node_modules/7zip-bin/**/*&quot;</span><span class="token punctuation">,</span>\n      <span class="token string">&quot;!node_modules/7zip-bin/linux/**&quot;</span><span class="token punctuation">,</span>\n      <span class="token string">&quot;!node_modules/7zip-bin/win/**&quot;</span>\n    <span class="token punctuation">]</span>\n  <span class="token punctuation">}</span><span class="token punctuation">,</span>\n  win<span class="token operator">:</span> <span class="token punctuation">{</span>\n    <span class="token comment">// ... å…¶ä»– win é…ç½®</span>\n    files<span class="token operator">:</span> <span class="token punctuation">[</span>\n      <span class="token string">&quot;node_modules/7zip-bin/**/*&quot;</span><span class="token punctuation">,</span>\n      <span class="token string">&quot;!node_modules/7zip-bin/linux/**&quot;</span><span class="token punctuation">,</span>\n      <span class="token string">&quot;!node_modules/7zip-bin/mac/**&quot;</span>\n    <span class="token punctuation">]</span>\n  <span class="token punctuation">}</span><span class="token punctuation">,</span>\n  linux<span class="token operator">:</span> <span class="token punctuation">{</span>\n    <span class="token comment">// ... å…¶ä»– linux é…ç½®</span>\n    files<span class="token operator">:</span> <span class="token punctuation">[</span>\n      <span class="token string">&quot;node_modules/7zip-bin/**/*&quot;</span><span class="token punctuation">,</span>\n      <span class="token string">&quot;!node_modules/7zip-bin/win/**&quot;</span><span class="token punctuation">,</span>\n      <span class="token string">&quot;!node_modules/7zip-bin/mac/**&quot;</span>\n    <span class="token punctuation">]</span>\n  <span class="token punctuation">}</span><span class="token punctuation">,</span>\n</code></pre></div><h2 id="å‘å¸ƒ"><a class="header-anchor" href="#å‘å¸ƒ" aria-hidden="true">#</a> å‘å¸ƒ</h2><p>è‡ªå¸¦çš„ github action ä¼šåœ¨ä½ æ¯ä¸ª PR æäº¤çš„æ—¶è·‘ eslint å’Œ <code>npm run build</code>ã€‚å¹¶ä¸ä¼šåšå®Œæ•´çš„ build ï¼ˆå› ä¸º build production æ¯”è¾ƒèŠ±æ—¶é—´ï¼Œå½“ç„¶ä½ å¯ä»¥è‡ªå·±æ‰“å¼€ï¼‰</p><p>å½“æœ‰æ–°çš„ push è¿›äº† master branchï¼Œgithub action ä¼šè‡ªåŠ¨åœ¨ windows/mac/linux ä¸Š build ç”Ÿäº§ç¯å¢ƒçš„ä»£ç ã€‚å¦‚æœæ„å»ºéƒ½æˆåŠŸäº†ï¼Œé™¤äº†ä¼šæŠŠæ„å»ºçš„è¾“å‡ºä¸Šä¼ åˆ° github assets ä¹‹å¤–ï¼Œå®ƒè¿˜ä¼šåˆ›å»ºä¸€ä¸ª PRï¼Œå…¶ä¸­ç»™ä½ æå‡äº† package.json çš„ç‰ˆæœ¬å·ï¼Œå¹¶ä¸”ä¼šå†™æ–°çš„ changelog åˆ° <a href="http://changelog.md" target="_blank" rel="noopener noreferrer">changelog.md</a> ä¸­ã€‚</p><p>å¦‚æœä½ æƒ³è¦å®ƒè‡ªåŠ¨ç”Ÿæˆ changelogï¼Œä½ å¾—éµå¾ª <a href="https://www.conventionalcommits.org/en/v1.0.0" target="_blank" rel="noopener noreferrer">conventional commit guideline</a>ã€‚</p><p>å®é™…åº”ç”¨ä¸­ä½ åªéœ€è¦æ£€æŸ¥è¿™ä¸ª PRï¼Œå¦‚æœæ²¡å•¥é—®é¢˜ç‚¹å‡»é€šè¿‡ï¼Œå®ƒå°±ä¼šå† build ä¸€éï¼Œå¹¶ä¸”å°†ç»“æœå‘å¸ƒåˆ° github release ä¸Šã€‚</p><p><strong>å¦‚æœä½ ä¸éœ€è¦è¿™ç§è‡ªåŠ¨æµç¨‹ï¼Œä½ å¯ä»¥å°†ä»¥ä¸‹æ–‡ä»¶ç§»é™¤ <a href="https://github.com/ci010/electron-vue-next/tree/master/electron-vue-next/.github/workflows/build.yml" target="_blank" rel="noopener noreferrer">.github/workflows/build.yml</a></strong></p><h3 id="è‡ªåŠ¨æ›´æ–°çš„æ”¯æŒ"><a class="header-anchor" href="#è‡ªåŠ¨æ›´æ–°çš„æ”¯æŒ" aria-hidden="true">#</a> è‡ªåŠ¨æ›´æ–°çš„æ”¯æŒ</h3><p>è¿™ä¸ªæ¨¡æ¿é»˜è®¤è‡ªå¸¦äº† <a href="https://github.com/electron-userland/electron-builder/tree/master/packages/electron-updater" target="_blank" rel="noopener noreferrer">electron-updater</a>ã€‚ä½ å¯ä»¥å‚ç…§ <a href="https://github.com/electron-userland/electron-builder" target="_blank" rel="noopener noreferrer">electron-builder</a> çš„æµç¨‹æ¥å®ç°è‡ªåŠ¨æ›´æ–°ã€‚</p>',159);t.render=function(a,e,t,p,c,r){return n(),s("div",null,[o])};export default t;export{e as __pageData};
